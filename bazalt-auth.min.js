!function(){define("bazalt-auth/app",["jquery","angular","angular-resource","angular-cookies"],function(a,b){"use strict";return b.module("bazalt-auth",["ngCookies"])}),define("bazalt-auth/controllers/baRegisterCtrl",["bazalt-auth/app"],function(a){a.controller("baRegisterCtrl",["$scope","$location","baUserResource","baConfig","$q",function(a,b,c,d,e){a.user={},a.registerUser=function(){var e=new c(a.user);a.loading=!0,e.$register(function(){a.loading=!1,b.path(d.baseUrl()+"/activationSent")},function(b){400==b.status&&a.register.invalidForm(b.data)})},a.checkEmail=function(a){var b=e.defer();return c.checkEmail({email:a},function(a){b.resolve(a.valid)},function(a){b.reject(a)}),b.promise},a.resendActivation=function(){$http.post("/account/resendActivation",a.form).success(function(){b.path("/activationResent")}).error(function(b){a.error=b.error.message})}}])}),define("bazalt-auth/controllers/baLoginCtrl",["bazalt-auth/app"],function(a){a.controller("baLoginCtrl",["$scope","$location","baAcl",function(a,b,c){a.form={},c.isLoggedIn()&&b.path("/user/profile"),a.loginUser=function(){var d=a.form;c.login(d,function(){b.path("/user/profile")},function(b){400==b.status&&a.login.invalidForm(b.data)})}}])}),define("bazalt-auth/controllers/baLogoutCtrl",["bazalt-auth/app"],function(a){a.controller("baLogoutCtrl",["$scope","$location","baAcl",function(a,b,c){c.logout(function(){b.path("/")})}])}),define("bazalt-auth/controllers",["bazalt-auth/controllers/baRegisterCtrl","bazalt-auth/controllers/baLoginCtrl","bazalt-auth/controllers/baLogoutCtrl"],function(){}),define("bazalt-auth/directives/baCompare",["bazalt-auth/app"],function(a){a.directive("baCompare",[function(){return{require:"ngModel",scope:{compareField:"=baCompare"},link:function(a,b,c,d){d.$parsers.unshift(function(b){var c=b==a.compareField;return d.$setValidity("baCompare",c),c?b:void 0}),d.$formatters.unshift(function(b){return d.$setValidity("baCompare",b==a.compareField),b})}}}])}),define("bazalt-auth/directives/baAccessLevel",["bazalt-auth/app"],function(a){a.directive("baAccessLevel",["baAcl","$rootScope",function(a,b){return{restrict:"A",scope:!1,link:function(c,d,e){function f(){c.user&&$(d).toggle(a.hasRight(e.baAccessLevel,a.user().acl))}c.user=a.user(),b.$watch("user",function(){f()},!0),b.$on("baUserLogin",function(){c.user=a.user(),f()})}}}])}),define("bazalt-auth/directives/ngUnique",["bazalt-auth/app"],function(a){a.directive("ngUnique",["$parse",function(a){return{require:"ngModel",scope:!1,link:function(b,c,d,e){var f=a(d.ngUnique);c.on("blur",function(){b.$apply(function(){f(b,{$value:c.val()}).then(function(a){e.$setValidity("unique",a),a||e.$setViewValue(void 0)})})})}}}])}),define("bazalt-auth/directives/remoteForm",["bazalt-auth/app"],function(a){a.directive("remoteForm",["$log",function(a){return{restrict:"A",scope:!1,require:"form",controller:["$scope",function(a){a.invalidForm=function(){}}],link:function(b,c,d,e){e.invalidForm=function(b){e.$setDirty(),a.error(b),angular.forEach(b,function(b,c){var d=e[c]||null;d||a.error("Field not found",c),angular.forEach(b,function(b,c){d?(d.$dirty=!0,d.$setValidity(c,!1)):a.error(d,b)})})}}}}])}),define("bazalt-auth/directives",["bazalt-auth/directives/baCompare","bazalt-auth/directives/baAccessLevel","bazalt-auth/directives/ngUnique","bazalt-auth/directives/remoteForm"],function(){}),define("bazalt-auth/factories/baUserResource",["bazalt-auth/app"],function(a){a.factory("baUserResource",["$resource","$q","baConfig",function(a,b,c){return a(c.apiEndpoint()+"/users/:id",{id:"@id"},{checkEmail:{method:"GET",params:{action:"checkEmail"}},"delete":{method:"DELETE"}})}])}),define("bazalt-auth/factories/baSessionResource",["bazalt-auth/app"],function(a){a.factory("baSessionResource",["$resource","$q","baConfig",function(a,b,c){return a(c.apiEndpoint()+"/sessions",{},{login:{method:"POST"},logout:{method:"DELETE"}})}])}),define("bazalt-auth/factories/baRoleResource",["bazalt-auth/app"],function(a){a.factory("baRoleResource",["$resource","$q","baConfig",function(a,b,c){return a(c.apiEndpoint()+"/roles/:id",{id:"@id"},{})}])}),define("bazalt-auth/factories/errorHttpInterceptor",["bazalt-auth/app"],function(a){a.factory("errorHttpInterceptor",["$q",function(a){return function(b){return b.then(function(a){return a},function(b){return 500==b.status&&console.error(b.data.error.message,b.data.error.file),405==b.status&&console.error(b.data),a.reject(b)})}}])}),define("bazalt-auth/factories",["bazalt-auth/factories/baUserResource","bazalt-auth/factories/baSessionResource","bazalt-auth/factories/baRoleResource","bazalt-auth/factories/errorHttpInterceptor"],function(){}),define("bazalt-auth/baConfig",["bazalt-auth/app"],function(a){"use strict";a.provider("baConfig",[function(){this.$baseUrl="/user",this.$templateUrl="/views/user",this.$apiEndpoint="/rest.php/auth",this.baseUrl=function(a){return this.$baseUrl=a,this},this.templateUrl=function(a){return this.$templateUrl=a,this},this.apiEndpoint=function(a){return this.$apiEndpoint=a,this},this.acl=function(a){return this.$levels=a,this},this.$get=function(){var a=this;return{baseUrl:function(){return a.$baseUrl},templateUrl:function(){return a.$templateUrl},apiEndpoint:function(){return a.$apiEndpoint},levels:function(){return a.$levels},roles:function(){return a.$roles}}},this.$buildRoles=function(a){var b="01",c={};for(var d in a){var e=parseInt(b,2);c[a[d]]={bitMask:e,title:a[d]},b=(e<<1).toString(2)}return c},this.$buildAccessLevels=function(a,b){var c={};for(var d in a)if("string"==typeof a[d])if("*"==a[d]){var e="";for(var f in b)e+="1";c[d]={bitMask:parseInt(e,2),title:a[d]}}else console.log("Access Control Error: Could not parse '"+a[d]+"' as access definition for level '"+d+"'");else{var e=0;for(var f in a[d])b.hasOwnProperty(a[d][f])?e|=b[a[d][f]].bitMask:console.log("Access Control Error: Could not find role '"+a[d][f]+"' in registered roles while building access for '"+d+"'");c[d]={bitMask:e,title:a[d][f]}}return c},this.$levels={system:{guest:1}}}]).run(["$rootScope","$location","baConfig","baAcl",function(a,b,c,d){var e=function(){a.error=null,a.user=d.user(),a.userRoles=c.roles(),a.acl=c.levels()};a.$on("$routeChangeStart",function(a,f){e(),angular.isDefined(f)&&angular.isDefined(f.$$route)&&f.$$route.hasOwnProperty("access")&&!d.hasRight(f.$$route.access)&&(d.isLoggedIn()?b.path("/"):b.path(c.baseUrl()+"/login"))}),e()}])}),define("bazalt-auth/baAcl",["bazalt-auth/app"],function(a){"use strict";a.factory("baAcl",["$rootScope","baSessionResource","baConfig","$cookieStore","$log",function(a,b,c,d,e){var f={acl:{guest:1}},g=function(b){b.acl||(b.acl={}),f=b,e.info("User login",f),a.$emit("baUserLogin",{user:f}),a.$$phase||a.$apply()};return a.user=f,d.get("user")&&b.get(function(a){a&&g(a)}),{hasRight:function(a,b){var d=c.levels(),g=a.split("."),h=d;b=b||f.acl;for(var i=0;i<g.length;i++){if(!h[g[i]])return e.error('Role "'+a+'" not found'),!1;h=h[g[i]]}return b[g[0]]?(h&b[g[0]])>=1:!1},isLoggedIn:function(a){return void 0===a&&(a=f),void 0!=a.login&&null!=a.login},register:function(a,b,c){$http.post("/register",a).success(function(a){g(a),b()}).error(c)},login:function(a,c,e){c=c||angular.noop,e=e||angular.noop,b.login(a,function(a){g(a),d.put("user",a),c(a)},function(a){e(a)})},logout:function(a,c){a=a||angular.noop,c=c||angular.noop,b.logout(function(b){g(b||{}),a(b)},c)},user:function(){return f}}}])}),define("bazalt-auth/routes",["bazalt-auth/app"],function(a){"use strict";a.config(["$routeProvider","$locationProvider","baConfigProvider",function(a,b,c){var d=c.$baseUrl,e=c.$templateUrl;a.when(d+"/register",{templateUrl:e+"/account/registerForm.html",controller:"baRegisterCtrl"}).when(d+"/terms",{templateUrl:e+"/modals/terms.html",controller:"baModalCtrl"}).when(d+"/privacy",{templateUrl:e+"/modals/privacy.html",controller:"baModalCtrl"}).when(d+"/activationSent",{templateUrl:e+"/account/registerSuccessMessage.html"}).when(d+"/resendActivation",{templateUrl:e+"/account/resendActivationForm.html",controller:"baRegisterCtrl"}).when(d+"/activationResent",{templateUrl:e+"/account/activationResentMessage.html",controller:"baRegisterCtrl"}).when(d+"/activate/:activationKey",{templateUrl:e+"/account/activationResentMessage.html",controller:"baRegisterCtrl"}).when(d+"/login",{templateUrl:e+"/account/loginForm.html",controller:"baLoginCtrl"}).when(d+"/logout",{template:"Loading...",controller:"baLogoutCtrl"})}])}),define("bazalt-auth",["angular","bazalt-auth/controllers","bazalt-auth/directives","bazalt-auth/factories","bazalt-auth/app","bazalt-auth/baConfig","bazalt-auth/baAcl","bazalt-auth/routes"],function(a){"use strict";return a.module("bazalt-auth")})}();
/*
//@ sourceMappingURL=bazalt-auth.min.map
*/